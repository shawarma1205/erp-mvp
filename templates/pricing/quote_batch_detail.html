<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quote Batch - {{ batch.name }}</title>
</head>
<body>
  <h1>Quote Batch: {{ batch.name }}</h1>

  <p>
    {{ T.language }}:
    <a href="?lang=ko">KO</a> |
    <a href="?lang=en">EN</a>
  </p>

  <p>
    FX Period: {{ batch.fx_period }} /
    FX (KRWâ†’PHP snapshot): {{ batch.fx_period.krw_to_php }} <br>
    Margin: {{ batch.company_margin_rate }} /
    Supplier markup: {{ batch.supplier_markup_rate }} /
    Transport: {{ batch.transport_mode }} ({{ batch.transport_krw_per_kg }} KRW/kg) /
    Round: {{ batch.rounding_unit_php }} PHP
  </p>

  <p>
    <a href="{% url 'pricing:quote_batch_export_csv' batch.id %}">{{ T.download_csv }}</a>
  </p>

  <hr>

  <h2>{{ T.batch_settings }}</h2>
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="form_type" value="batch_settings">

    <label>{{ T.company_margin_rate }}:</label>
    <input name="company_margin_rate" value="{{ batch.company_margin_rate }}" required>
    <br><br>

    <label>{{ T.supplier_markup_rate }}:</label>
    <input name="supplier_markup_rate" value="{{ batch.supplier_markup_rate }}" required>
    <br><br>

    <label>{{ T.transport_mode }}:</label>
    <select name="transport_mode">
      <option value="OCEAN" {% if batch.transport_mode == "OCEAN" %}selected{% endif %}>OCEAN</option>
      <option value="AIR" {% if batch.transport_mode == "AIR" %}selected{% endif %}>AIR</option>
    </select>
    <br><br>

    <label>{{ T.transport_krw_per_kg }}:</label>
    <input name="transport_krw_per_kg" value="{{ batch.transport_krw_per_kg }}" required>
    <br><br>

    <label>{{ T.rounding_unit_php }}:</label>
    <input name="rounding_unit_php" value="{{ batch.rounding_unit_php }}" required>
    <br><br>

    <button type="submit">Update Batch</button>
  </form>

  <hr>

  <h2>{{ T.add_quote_line }}</h2>
  <form method="post">
    {% csrf_token %}
    <label>{{ T.sku_code }}:</label>
    <input name="sku_code" placeholder="SALMON-001" required>
    <br><br>

    <label>{{ T.qty_units }}:</label>
    <input name="qty_units" value="1" required>
    <br><br>

    <label>{{ T.supplier_cost_krw_per_unit }}:</label>
    <input name="supplier_cost_krw_per_unit" value="0" required>
    <br><br>

    <label>{{ T.billable_weight_kg_total }}:</label>
    <input name="billable_weight_kg_total" value="0" required>
    <br><br>

    <label>{{ T.other_cost_php_total }}:</label>
    <input name="other_cost_php_total" value="0">
    <br><br>

    <label>{{ T.manual_price_php_per_unit }}:</label>
    <input name="manual_price_php_per_unit" value="">
    <br><br>


    <button type="submit">Create</button>
  </form>

  <hr>

  <h2>{{ T.lines }}</h2>
  <table border="1" cellpadding="6">
    <thead>
      <tr>
        <th>Created</th>
        <th>SKU</th>
        <th>Name</th>
        <th>Qty</th>

        <th>Supplier KRW/unit</th>
        <th>Weight KG</th>

        <th>{{ T.suggested_price }}</th>
        <th>{{ T.manual_price }}</th>
        <th>{{ T.price_diff_pct }}</th>

        <th>Final PHP/unit</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      {% for ln in lines %}
      <tr>
  <td>{{ ln.obj.created_at }}</td>
  <td>{{ ln.obj.product.sku_code }}</td>

  <td>
    {% if lang == "en" %}
      {{ ln.obj.product.name_en }}
    {% else %}
      {{ ln.obj.product.name_ko }}
    {% endif %}
  </td>

  <td>{{ ln.obj.qty_units }}</td>
  <td>{{ ln.obj.supplier_cost_krw_per_unit }}</td>
  <td>{{ ln.obj.billable_weight_kg_total }}</td>

  <td>{{ ln.suggested_price }}</td>

  <td>{{ ln.obj.manual_price_php_per_unit|default:"-" }}</td>

  <td>
    {% if ln.diff_pct is not None %}
      {{ ln.diff_pct|floatformat:1 }}%
    {% else %}
      -
    {% endif %}
  </td>

  <td><b>{{ ln.obj.final_price_php_per_unit }}</b></td>

  <td>
    <form method="post" action="{% url 'pricing:quote_line_delete' batch.id ln.obj.id %}">
      {% csrf_token %}
      <button type="submit">Delete</button>
    </form>
  </td>
</tr>

      {% endfor %}
    </tbody>
  </table>
</body>
</html>

